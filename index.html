<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Monitoring: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="o2_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Monitoring
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Monitoring Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/AliceO2Group/Monitoring">![travis-ci](https://api.travis-ci.org/AliceO2Group/Monitoring.svg?branch=master)</a> <a href="https://alisw.cern.ch/dashboard/d/000000001/main-dashboard?orgId=1&amp;var-storagename=All&amp;var-reponame=All&amp;var-checkname=build%2FMonitoring%2Fo2-dataflow%2F0&amp;var-upthreshold=30m&amp;var-minuptime=30">![aliBuild](https://img.shields.io/badge/aliBuild-dashboard-lightgrey.svg)</a> <a href="https://alice.its.cern.ch/jira/projects/OMON">![JIRA](https://img.shields.io/badge/JIRA-issues-blue.svg)</a></p>
<p>Monitoring module allows to inject user defined metrics and monitor the process itself. It supports multiple backends, protocols and data formats.</p>
<h2>Table of contents</h2>
<ol type="1">
<li><a href="#installation">Installation</a></li>
<li><a href="#getting-started">Getting started</a></li>
<li><a href="#features-and-additional-information">Features and additional information</a></li>
<li><a href="#code-snippets">Code snippets</a></li>
<li><a href="#system-monitoring-server-side-backends-installation-and-configuration">System monitoring and server-side backends installation and configuration</a></li>
</ol>
<h2>Installation</h2>
<h3>RPM (CentOS 7 only)</h3>
<ul>
<li>Install CERN certificates <div class="fragment"><div class="line">yum -y install CERN-CA-certs</div>
</div><!-- fragment --></li>
<li>Add <code>alisw</code> repo **(as root)** <div class="fragment"><div class="line">cat &gt; /etc/yum.repos.d/alisw-el7.repo &lt;&lt;EOF</div>
<div class="line">[alisw-el7]</div>
<div class="line">name=ALICE Software - EL7</div>
<div class="line">baseurl=https:<span class="comment">//ali-ci.cern.ch/repo/RPMS/el7.x86_64/</span></div>
<div class="line">enabled=1</div>
<div class="line">gpgcheck=0</div>
<div class="line">EOF</div>
</div><!-- fragment --></li>
<li>Install Monitoring RPM package **(as root)** <div class="fragment"><div class="line">yum -y install alisw-<a class="code" href="d4/d49/classo2_1_1monitoring_1_1MonitoringFactory.html">Monitoring</a>+v1.5.4-1.x86_64</div>
</div><!-- fragment --></li>
<li>Configure Modules <div class="fragment"><div class="line">export MODULEPATH=/opt/alisw/el7/modulefiles:$MODULEPATH</div>
</div><!-- fragment --></li>
<li>Load enviroment <div class="fragment"><div class="line">eval `modulecmd bash load <a class="code" href="d4/d49/classo2_1_1monitoring_1_1MonitoringFactory.html">Monitoring</a>/v1.5.4-1`</div>
</div><!-- fragment --> The installation directory is: <code>/opt/alisw/el7/Monitoring/v1.5.4-1</code></li>
</ul>
<h3>aliBuild</h3>
<p><b><a href="https://alice-doc.github.io/alice-analysis-tutorial/building/">Click here if you don't have aliBuild installed</a></b> <br/>
</p>
<ul>
<li>Compile <code>Monitoring</code> and its dependecies via <code>aliBuild</code> <div class="fragment"><div class="line">aliBuild init <a class="code" href="d4/d49/classo2_1_1monitoring_1_1MonitoringFactory.html">Monitoring</a>@master</div>
<div class="line">aliBuild build <a class="code" href="d4/d49/classo2_1_1monitoring_1_1MonitoringFactory.html">Monitoring</a> --defaults o2-daq</div>
</div><!-- fragment --></li>
<li>Load the enviroment for Monitoring (in the <code>alice</code> directory) <div class="fragment"><div class="line">alienv load <a class="code" href="d4/d49/classo2_1_1monitoring_1_1MonitoringFactory.html">Monitoring</a>/latest</div>
</div><!-- fragment --></li>
</ul>
<p>In case of an issue with <code>aliBuild</code> refer to <a href="https://alice-doc.github.io/alice-analysis-tutorial/building">the official instructions</a>.</p>
<h3>Manual</h3>
<p>Manual installation of the O<sup>2</sup> Monitoring module.</p>
<h4>Requirements</h4>
<ul>
<li>C++ compiler with C++14 support, eg.:<ul>
<li><code>gcc-c++</code> package from <code>devtoolset-6</code> on CentOS 7</li>
<li><code>clang++</code> on Mac OS</li>
</ul>
</li>
<li>Boost &gt;= 1.56</li>
<li>libcurl</li>
<li><a href="http://monalisa.caltech.edu/monalisa__Download__ApMon.html">ApMon</a> (optional)</li>
</ul>
<h4>Monitoring module compilation</h4>
<div class="fragment"><div class="line">git clone https:<span class="comment">//github.com/AliceO2Group/Monitoring.git</span></div>
<div class="line">cd <a class="code" href="dd/d84/10-Buffering_8cxx.html#acb6d4b5797791875a3522f9eee61964a">Monitoring</a>; mkdir build; cd build</div>
<div class="line">cmake .. -DCMAKE_INSTALL_PREFIX=&lt;installdir&gt;</div>
<div class="line">make -j</div>
<div class="line">make install</div>
</div><!-- fragment --><h2>Getting started</h2>
<h3>Monitoring instance</h3>
<p>The recommended way of getting (<code>unique_ptr</code> to) monitoring instance is <code>Get</code>ing it from <code>MonitoringFactory</code> by passing backend URI(s) as a parameter (comma seperated if more than one). The library is accessible from <code><a class="el" href="da/d75/namespaceo2_1_1monitoring.html" title="ALICE O2 Monitoring system. ">o2::monitoring</a></code> namespace.</p>
<p>```cpp using namespace <a class="el" href="da/d75/namespaceo2_1_1monitoring.html" title="ALICE O2 Monitoring system. ">o2::monitoring</a>; MonitoringFactory::Get("backend[-protocol]://host:port[?query]"); ``<code> See table below to find out how to create</code>URI` for each backend:</p>
<table class="doxtable">
<tr>
<th>Backend name </th><th align="center">Transport </th><th align="center">URI backend[-protocol] </th><th align="right">URI query  </th></tr>
<tr>
<td>InfluxDB </td><td align="center">HTTP </td><td align="center"><code>influxdb-http</code> </td><td align="right"><code>/write?db=&lt;db&gt;</code> </td></tr>
<tr>
<td>InfluxDB </td><td align="center">UDP </td><td align="center"><code>influxdb-udp</code> </td><td align="right">- </td></tr>
<tr>
<td>ApMon </td><td align="center">UDP </td><td align="center"><code>apmon</code> </td><td align="right">- </td></tr>
<tr>
<td>InfoLogger </td><td align="center">- </td><td align="center"><code>infologger</code> </td><td align="right">- </td></tr>
<tr>
<td>Flume </td><td align="center">UDP </td><td align="center"><code>flume</code> </td><td align="right">- </td></tr>
</table>
<h3>Sending metric</h3>
<p>```cpp send(Metric&amp;&amp; metric) ``` Where metric constructor receives following parameters:</p>
<ul>
<li><code>T value</code></li>
<li><code>std::string&amp; name</code></li>
<li><code>[time_point&lt;system_clock&gt; timestamp]</code></li>
</ul>
<p>For example: ```cpp monitoring-&gt;send({10, "myMetricInt"}); ```</p>
<h3>Customized metrics</h3>
<p>Two additional methods can be chained the to <code>send(Metric&amp;&amp; metric)</code> in order to <b>insert custom tags</b> or <b>set custom timestamp</b>:</p>
<ul>
<li><code>addTags(std::vector&lt;Tag&gt;&amp;&amp; tags)</code></li>
<li><code>setTimestamp(std::chrono::time_point&lt;std::chrono::system_clock&gt;&amp; timestamp)</code></li>
</ul>
<p>For example: ```cpp monitoring-&gt;send(Metric{10, "myMetric"}.addTags({{"tag1", "value1"}, {"tag2", "value2"}})); monitoring-&gt;send(Metric{10, "myCrazyMetric"}.setTimestamp(timestamp)); ```</p>
<h2>Features and additional information</h2>
<h3>Grouped values</h3>
<p>It's also possible to send multiple, grouped values in a single metric (<code>Flume</code> and <code>InfluxDB</code> backends are supproted, others fallback into sending values in seperate metrics) ```cpp void sendGroupped(std::string name, std::vector&lt;Metric&gt;&amp;&amp; metrics) ```</p>
<p>For example: ```cpp monitoring-&gt;sendGroupped("measurementName", {{20, "myMetricIntMultiple"}, {20.30, "myMetricFloatMultple"}}); ```</p>
<h3>Buffering metrics</h3>
<p>In order to avoid sending each metric separately, metrics can be temporary stored in the buffer and flushed at the most convenient moment. This feature can be operated with following two methods: ```cpp monitoring-&gt;enableBuffering(const unsigned int maxSize) ... monitoring-&gt;flushBuffer(); ```</p>
<p><code>enableBuffering</code> takes maximum buffer size as its parameter. The buffer gets full all values are flushed automatically.</p>
<p>For example: ```cpp monitoring-&gt;enableBuffering(5); for (int i = 1; i &lt; 10; i++) { monitoring-&gt;send({10, "myMetricInt"}); } monitoring-&gt;send({20, "myMetricInt2"}); monitoring-&gt;flushBuffer(); ```</p>
<h3>Metrics</h3>
<p>Metrics consist of 4 parameters: name, value, timestamp and tags.</p>
<table class="doxtable">
<tr>
<th>Parameter name </th><th align="center">Type </th><th align="center">Required </th><th align="right">Default  </th></tr>
<tr>
<td>name </td><td align="center">string </td><td align="center">yes </td><td align="right">- </td></tr>
<tr>
<td>value </td><td align="center">int / double / string / uint64_t </td><td align="center">yes </td><td align="right">- </td></tr>
<tr>
<td>timestamp </td><td align="center">chrono::time_point&lt;std::chrono::system_clock&gt; </td><td align="center">no </td><td align="right">current timestamp </td></tr>
<tr>
<td>tags </td><td align="center">vector&lt;Tag&gt; </td><td align="center">no </td><td align="right">-** </td></tr>
</table>
<p>**Default tag set is process specific and included in each metric:</p>
<ul>
<li>hostname</li>
<li>PID</li>
<li>process name</li>
</ul>
<h3>Calculating derived metrics</h3>
<p>The module can calculate derived metrics. To do so, use <code>addDerivedMetric(std::string name, DerivedMetricMode mode)</code> with one of two available modes:</p>
<ul>
<li><code>DerivedMetricMode::RATE</code> - rate between two following metrics;</li>
<li><code>DerivedMetricMode::AVERAGE</code> - average value of all metrics stored in cache;</li>
</ul>
<p>Derived metrics are generated each time as new value is passed to the module. Their names are suffixed with derived mode name.</p>
<h3>Monitoring process</h3>
<p>Currently process monitoring is supported only on Linux. To enable it use: ```cpp enableProcessMonitoring([interval in seconds]); ``` The following metrics are generated every interval:</p>
<ul>
<li><b>cpuUsedPercentage</b> - percentage of a core usage over time interval (from <code>gerrusage</code>)</li>
<li><b>involuntaryContextSwitches</b> - involuntary context switches over time interval (from <code>gerrusage</code>)</li>
<li><b>memoryUsagePercentage</b> - ratio of the process's resident set size to the physical memory on the machine, expressed as a percentage (from <code>ps</code>)</li>
<li><b>bytesReceived</b> - the total number of bytes of data received by the process per interface (from <code>/proc/[PID]/net/dev</code>)</li>
<li><b>bytesTransmitted</b> - the total number of bytes of data transmitted by the process per interface (from <code>/proc/[PID]/net/dev</code>).</li>
</ul>
<h2>Code snippets</h2>
<p>Code snippets are available in <a href="examples/">examples</a> directory.</p>
<ul>
<li>Sending metric - <a href="examples/1-Basic.cxx">examples/1-Basic.cxx</a></li>
<li>Sending metric with custom taggs - <a href="examples/2-TaggedMetrics.cxx">examples/2-TaggedMetrics.cxx</a></li>
<li>Sending metric with user defined timestamp - <a href="examples/3-UserDefinedTimestamp.cxx">examples/3-UserDefinedTimestamp.cxx</a></li>
<li>Calculating derived metrics - <a href="examples/4-RateDerivedMetric.cxx">examples/4-RateDerivedMetric.cxx</a></li>
<li>Sending multiple values in a single metric - <a href="examples/8-Multiple.cxx">examples/8-Multiple.cxx</a></li>
</ul>
<h2>System monitoring, server-side backends installation and configuration</h2>
<p>This guide explains manual installation. For <code>ansible</code> deployment see <a href="https://gitlab.cern.ch/AliceO2Group/system-configuration/tree/master/ansible">AliceO2Group/system-configuration</a> gitlab repo.</p>
<ul>
<li><a class="el" href="dd/ded/collectd_8md.html">Collectd</a></li>
<li><a class="el" href="d9/d54/flume_8md.html">Flume</a></li>
<li><a class="el" href="d6/d9b/influxdb_8md.html">InfluxDB</a></li>
<li><a class="el" href="d3/dba/grafana_8md.html">Grafana</a></li>
<li><a href="http://monalisa.caltech.edu/monalisa__Documentation__Service_Installation_Guide.html">MonALISA</a> (external link) </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 23 2018 08:00:15 for Monitoring by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
